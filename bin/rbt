#!/usr/bin/env ruby
#-*- coding: utf-8 -*-
# vim: filetype=ruby

require 'fileutils'


o = {}
o[:rubies] = File.exist?(File.expand_path('~/.ruby-tapper-rubies_dir_config')) ?
               File.read(File.expand_path('~/.ruby-tapper-rubies_dir_config')).chomp : ''
o[:suffix] = ""
o[:prefix] = ""

case ARGV.shift
when '--rubies'
  o[:rubies] = ARGV.shift.chomp.gsub(/\/$/,'')
  open(File.expand_path('~/.ruby-tapper-rubies_dir_config'),'w') do |f|
    f.puts o[:rubies]
  end
  puts "Add #{o[:rubies]}/bin to $PATH of your shell."
  puts "Set #{o[:rubies]}/gem to $GEM_HOME of your shell."
  exit
when /--suffix=(.+)/
  o[:suffix] = $1
when /--prefix=(.+)/
  o[:prefix] = $1
end

o[:version]  = ARGV.shift
o[:bin]      = o[:rubies]   + '/bin'
o[:gem]      = o[:rubies]   + '/gem'
o[:gems]     = o[:rubies]   + '/gems'
o[:gem_home] = o[:gems]     + '/'     + o[:version]
o[:gem_bin]  = o[:gem_home] + '/bin'
o[:ruby]     = o[:rubies]   + '/'     + o[:version]
o[:ruby_bin] = o[:rubies]   + '/'     + o[:version] + '/bin'

abort "#{o[:ruby]} Not exist!" unless File.exist?(o[:ruby])
abort "#{o[:ruby_bin]} Not exist!" unless File.exist?(o[:bin])


##################### Open a ruby tapper #####################

######### Create directory some #########

#### rubies/bin ####

Dir.mkdir(o[:bin]) unless File.exist?(o[:bin])

#### rubies/gems ####

Dir.mkdir(o[:gems]) unless File.exist?(o[:gems])

#### rubies/gems/{ver} ####

Dir.mkdir(o[:gem_home]) unless File.exist?(o[:gem_home])

#### rubies/gems/{ver}/bin ####

Dir.mkdir(o[:gem_bin]) unless File.exist?(o[:gem_bin])

######### Create symbolic link #########

#### Ruby ####

#### Gems ####

######### Set gem box #########


